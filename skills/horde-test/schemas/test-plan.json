{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://kurultai.io/schemas/horde-test/test-plan.json",
  "title": "Horde Test Plan",
  "description": "Schema for defining comprehensive test plans executed by horde-test",
  "type": "object",
  "required": ["plan_id", "version", "suites"],
  "properties": {
    "plan_id": {
      "type": "string",
      "description": "Unique identifier for this test plan",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 64
    },
    "version": {
      "type": "string",
      "description": "Semantic version of the test plan",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "context": {
      "type": "object",
      "description": "Context inherited from horde-implement Phase 6",
      "properties": {
        "implementation_files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files that were implemented"
        },
        "test_requirements": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Specific test requirements"
        },
        "coverage_target": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Target coverage percentage"
        }
      }
    },
    "scope": {
      "type": "object",
      "properties": {
        "include_patterns": {
          "type": "array",
          "items": { "type": "string" },
          "description": "File patterns to include"
        },
        "exclude_patterns": {
          "type": "array",
          "items": { "type": "string" },
          "description": "File patterns to exclude"
        },
        "max_files": {
          "type": "integer",
          "minimum": 1,
          "description": "Limit number of files to test"
        }
      }
    },
    "suites": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "category"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Suite name",
            "minLength": 1,
            "maxLength": 64
          },
          "category": {
            "type": "string",
            "enum": ["unit", "integration", "e2e", "performance", "security", "accessibility"],
            "description": "Test category"
          },
          "files": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Files to test"
          },
          "dependencies": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Other suites that must pass first"
          },
          "config": {
            "type": "object",
            "properties": {
              "timeout": {
                "type": "integer",
                "minimum": 1,
                "description": "Timeout in seconds"
              },
              "retries": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5,
                "description": "Retry attempts on failure"
              },
              "parallel": {
                "type": "boolean",
                "description": "Run tests in parallel"
              },
              "coverage": {
                "type": "boolean",
                "description": "Track coverage for this suite"
              }
            }
          }
        }
      }
    },
    "execution": {
      "type": "object",
      "properties": {
        "max_parallel_suites": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Max concurrent test suites"
        },
        "fail_fast": {
          "type": "boolean",
          "description": "Stop on first failure"
        },
        "continue_on_failure": {
          "type": "boolean",
          "description": "Continue despite failures"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "description": "Global timeout in seconds"
        }
      }
    },
    "coverage": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable coverage tracking"
        },
        "targets": {
          "type": "object",
          "properties": {
            "line": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Line coverage target"
            },
            "branch": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Branch coverage target"
            },
            "function": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Function coverage target"
            }
          }
        },
        "fail_on_missed": {
          "type": "boolean",
          "description": "Fail if coverage targets not met"
        }
      }
    },
    "success_criteria": {
      "type": "object",
      "properties": {
        "min_pass_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Minimum pass percentage"
        },
        "critical_suites": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Suites that must 100% pass"
        },
        "no_critical_failures": {
          "type": "boolean",
          "description": "Fail if any critical test fails"
        }
      }
    }
  }
}
